.. _alta-disponibilidad:

===================================================
 Configuración del servicio en alta disponibilidad
===================================================

Es posible configurar un conjunto de servidores iCMS para que operen en modo distribuido,
consiguiendo una mayor tolerancia a fallos y un incremento del tiempo de servicio. Para ello, sólo
es necesario tener en cuenta una serie de detalles a la hora de realizar la configuración de los
servidores, que son los siguientes:

**Url de servicio única**
  Es necesario que todos los servidores identifiquen una *url* de operaciones común a todos ellos,
  que será probablemente la *url* del balanceador de carga.

**Configuración común de colecciones y parámetros de ejecución**
  Los distintos servidores tienen que tener configuradas las mismas colecciones y los mismos
  parámetros de ejecución (por ejemplo, mismo número de elementos por página) para no incidir en
  inconsistencias en sucesivas peticiones (caché no válida, colecciones accesibles aleatoriamente).

**Caché replicada o distribuida**
  El sistema de caché de *iCMS* se puede distribuir entre varias máquinas utilizando mecanismos de
  replicación o de distribución propios de la solución utilizada (Ehcache). Todos aquellos
  servidores que estén operando como un único nodo deberán tener una caché común para el intercambio
  de información (este sistema de caché se utiliza, además de para las operaciones habituales, como
  almacén de información distribuida acerca de suscripciones y estado de los servidores). En el
  apartado correspondiente a la :ref:`configuración de caché <configuración-caché>` se pueden encontrar ejemplos de configuración
  en los modos replicado y distribuido.

**Carpetas de configuración y logs compartidas**
  Para un correcto funcionamiento del servicio en alta disponibilidad, es
  requisito que se compartan a nivel de red una serie de carpetas de
  configuración y datos. Las mismas deben estar compartidas utilizando uno de
  los múltiples protocolos existentes para tal efecto (NFS, SSH, Samba, ...).
  El único requisito es que a efectos del servidor las carpetas montadas en
  red se comporten como si fueran locales.

  La carpeta de configuración 
  obligatoriamente tiene que estar compartidas para un correcto funcionamiento
  del servicio en alta disponibilidad.

  La configuración de parámetros propios de cada nodo se realiza en el
  :ref:`script de arranque del servicio <script-arranque>`, mediante la
  definición de una serie de variables de entorno al inicio del mismo.

  Si se desea contar con un log único para todos los nodos de un sistema, será
  necesario compartir la carpeta ``logs``, de tal manera que todos los nodos
  compartan el fichero.

.. figure:: /images/alta-disponibilidad.jpg
   :scale: 75%
   :align: center

   Configuración en alta disponibilidad

