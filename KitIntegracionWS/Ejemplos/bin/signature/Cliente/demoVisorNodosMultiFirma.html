<html>
    <head>
	    <link rel="stylesheet" href="style.css" type="text/css">
    
        <title>Demostración. Visor de nodos multifirma</title>
		<script type="text/javascript" language="javascript" src="constantes.js"></script>
		<script type="text/javascript" language="javascript" src="common-js/time.js"></script>
		<script type="text/javascript" language="javascript" src="common-js/appletHelper.js"></script>
		<script type="text/javascript" language="javascript" src="common-js/instalador.js"></script>
		<script type="text/javascript" language="javascript" src="common-js/firma.js"></script>

        <script language="javascript">
        	function configureEntradaESignature()
        	{	// Establecemos la firma electrónica de entrada
        		var aux= getRadioValue(document.prueba.fe_entrada)
        		if(aux=="file")
        		{
	        		clienteFirma.setElectronicSignatureFile(document.getElementById('fe_file').value)
        		}
        		else if(aux=="data")
        		{
	        		clienteFirma.setElectronicSignature(document.getElementById('fe_b64').value)
        		}
        		else if(aux=="none")
        		{
        		}
        	}
        	
        	function configure()
        	{
        	    // Inicializamos
        		clienteFirma.initialize();

				configureEntradaESignature();
        		
        		// Mostrar errores
        		clienteFirma.setShowErrors(true);
        	}
        	
        	function tabula(src)
        	{
        		var x= "";
        		var src= ""+src;

        		var i;
        		for(i=0; i<src.length; i++)
        		{
        			if(src.charAt(i)!= 9  && src.charAt(i)!='\t')
        			{
        				break;
        			}
        		}
        		
        		if(i>0)
        		{
					var j;
        			for(j=0; j<i-1; j++)
        			{
        				if(j!=0)
        				{
	        				x += "| ";
	        			}
	        			else
	        			{
	        				x += "  ";
	        			}
        			}
        			if(j==0)
        			{
        				x+= "  +-->";
        			}
        			else
        			{
	        			x+= "| +-->";
	        		}
        			x+= src.substring(i);
        		}
        		else
        		{
        			x= src;
        		}
        		return x;
        	}
        	
        	function seleccionarFirmantes()
        	{
	        	document.prueba.firmantes.disabled= true;
	        	
	        	configure();
	        	
	        	var aux= clienteFirma.getSignersStructure().split('\n');
        		document.prueba.firmantes.options.length = 0;
        		document.prueba.firmantes.style.display='block';
	        	if(clienteFirma.isError())
	        	{
	        		document.prueba.firmantes.options[0]= new Option("Error: "+clienteFirma.getErrorMessage());
	        	}
	        	else
	        	{
		        	var i;
		        	for(i=0; i<aux.length; i++)
		        	{
		        		document.prueba.firmantes.options[i]= new Option(tabula(aux[i]), aux[i]);
		        	}
		        	document.prueba.firmantes.disabled= false;
		      	}
        	}
        	
        	function srcESignChanged()
        	{
        		src= getRadioValue(document.prueba.fe_entrada)

        		if(src=="none")
        		{
        			document.getElementById('fe_file').style.display='none';
        			document.getElementById('fe_b64').style.display='none';
        		}
        		else if(src=="data" || src=="hash")
        		{
        			document.getElementById('fe_file').style.display='none';
        			document.getElementById('fe_b64').style.display='block';
        		}
        		else if(src=="file")
        		{
        			document.getElementById('fe_file').style.display='block';
        			document.getElementById('fe_b64').style.display='none';
        		}
        	}
        	
        	function getRadioValue(aux)
        	{
        		for(i=0; i<aux.length; i++)
    	    	{
    	    		if(aux[i].checked== true || aux[i].selected=="selected")
    	    		{
    	    			return aux[i].value;
    	    		}
    	    	}
        	}
        </script>
    </head>
    <body onload="cargarAppletFirma();">
<form name="prueba">
<table align="center">
	<tr>
		<td>
		<fieldset>
		<table>
			<tr>
				<td>
				<fieldset><legend>Entrada de firma electrónica</legend>
				<table>
					<tr>
						<td><input type="radio" name="fe_entrada"
							onchange="srcESignChanged()" onclick="srcESignChanged()"
							value="none" checked="checked">Fichero binario a elegir</td>
						<td rowspan="4"><input name="fe_file" id="fe_file" type="file"
							style="display: none;"> <textarea name="fe_b64" id="fe_b64"
							style="display: none;" cols="40" rows="10"></textarea></td>
					</tr>
					<tr>
						<td><input type="radio" name="fe_entrada"
							onchange="srcESignChanged()" onclick="srcESignChanged()"
							value="file">Fichero binario</td>
					</tr>
					<tr>
						<td><input type="radio" name="fe_entrada"
							onchange="srcESignChanged()" onclick="srcESignChanged()"
							value="data">Datos(en base 64)</td>
					</tr>
				</table>
				</fieldset>
			</tr>
			<tr>
				<td align="center"><input type="button" title="coSign"
					onclick="seleccionarFirmantes(); return false;"
					value="Mostrar estructura"><br>
				</td>
			</tr>
	<tr><td><select multiple="multiple" name="firmantes" id="firmantes" disabled="disabled" style="font-family: monospace;display:none"></select></td></tr>
		</table>
		</fieldset>
		</td>
	</tr>
</table>
</form>
</body>
</html>